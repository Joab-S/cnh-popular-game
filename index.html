<!DOCTYPE html>
<html lang="pt-br">
  <head>
    <!-- Google Tag Manager -->
    <script>
      (function (w, d, s, l, i) {
        w[l] = w[l] || [];
        w[l].push({ "gtm.start": new Date().getTime(), event: "gtm.js" });
        var f = d.getElementsByTagName(s)[0],
          j = d.createElement(s),
          dl = l != "dataLayer" ? "&l=" + l : "";
        j.async = true;
        j.src = "https://www.googletagmanager.com/gtm.js?id=" + i + dl;
        f.parentNode.insertBefore(j, f);
      })(window, document, "script", "dataLayer", "GTM-TWVM8MV8");
    </script>
    <!-- End Google Tag Manager -->
    <meta charset="utf-8" />
    <meta
      name="viewport"
      content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Press+Start+2P&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Silkscreen&display=swap"
      rel="stylesheet"
    />
    <link
      href="https://fonts.googleapis.com/css2?family=Jersey+10&family=Jersey+15&family=Silkscreen:wght@400;700&display=swap"
      rel="stylesheet"
    />
    <link rel="icon" href="./public/assets/images/favicon.png" />
    <title>CNH Popular - Jogo</title>
  </head>
  <body style="margin: 0; background: #0e0e0e">
    <!-- Google Tag Manager (noscript) -->
    <noscript
      ><iframe
        src="https://www.googletagmanager.com/ns.html?id=GTM-TWVM8MV8"
        height="0"
        width="0"
        style="display: none; visibility: hidden"
      ></iframe
    ></noscript>
    <!-- End Google Tag Manager (noscript) -->
    <div id="viewport">
      <div id="game"></div>
    </div>

    <!-- Phaser 3 via CDN -->
    <script src="https://cdn.jsdelivr.net/npm/phaser@3.80.0/dist/phaser.js"></script>

    <!-- Nosso jogo -->
    <script type="module" src="./src/core/main.js"></script>
    <script>
      function getViewport() {
        const vv = window.visualViewport;
        if (vv) {
          return { width: vv.width, height: vv.height };
        } else {
          return { width: window.innerWidth, height: window.innerHeight };
        }
      }

      function adjustOrientation() {
        const view = document.getElementById("game");
        const el = document.querySelector("canvas");
        if (!el) return;

        const isMobile = /Android|iPhone|iPad|iPod/i.test(navigator.userAgent);
        const { width: vw, height: vh } = getViewport();
        const isPortrait = vh > vw;

        // Reset padrÃ£o
        Object.assign(view.style, {
          position: "fixed",
          width: "100vw",
          height: "100vh",
          top: "0",
          left: "0",
          background: "#ffffff",
          overflow: "hidden",
        });

        Object.assign(el.style, {
          position: "absolute",
          transform: "none",
          transformOrigin: "center center",
          top: "50%",
          left: "50%",
        });

        if (isMobile && isPortrait) {
          const GAME_WIDTH = 800;
          const GAME_HEIGHT = 450;

          const screenWidth = vw;
          const screenHeight = vh;
          const gameRatio = GAME_WIDTH / GAME_HEIGHT;
          const screenRatio = screenWidth / screenHeight;

          let finalWidth, finalHeight;

          if (screenRatio > gameRatio) {
            finalHeight = screenHeight;
            finalWidth = finalHeight * gameRatio;
          } else {
            finalWidth = screenWidth;
            finalHeight = finalWidth / gameRatio;
          }

          Object.assign(el.style, {
            width: `${finalWidth}px`,
            height: `${finalHeight}px`,
            transformOrigin: "center center",
            transform: `
              translate(-50%, -50%)
              rotate(90deg)
              scale(${Math.min(screenWidth / finalHeight, screenHeight / finalWidth)})
            `,
          });
        } else {
          Object.assign(el.style, {
            width: "100%",
            height: "100%",
            transform: `
              translate(-50%, -50%)
              rotate(0deg)
            `,
          });
        }
      }

      window.addEventListener("load", adjustOrientation);
      window.addEventListener("resize", adjustOrientation);
      window.addEventListener("orientationchange", adjustOrientation);
      window.visualViewport &&
        window.visualViewport.addEventListener("resize", adjustOrientation);
    </script>
  </body>
</html>
